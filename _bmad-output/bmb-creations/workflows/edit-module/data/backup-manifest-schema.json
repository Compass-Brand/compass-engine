{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://bmad.dev/schemas/backup-manifest.json",
  "title": "BMAD Backup Manifest",
  "description": "JSON Schema for validating backup manifest files created during edit-module workflow",
  "type": "object",
  "required": [
    "manifestVersion",
    "sessionId",
    "transactionId",
    "createdAt",
    "modulePath",
    "backupPath",
    "files",
    "totalFiles",
    "totalSizeBytes",
    "allVerified",
    "status"
  ],
  "properties": {
    "manifestVersion": {
      "type": "string",
      "description": "Schema version for the manifest format",
      "pattern": "^\\d+\\.\\d+$",
      "examples": ["1.0"]
    },
    "sessionId": {
      "type": "string",
      "description": "Unique identifier for the edit session",
      "pattern": "^edit-\\d{4}-\\d{2}-\\d{2}-\\d{4}-[a-f0-9]{4}$",
      "examples": ["edit-2026-01-07-1430-a7f2"]
    },
    "transactionId": {
      "type": "string",
      "description": "UUID for this specific backup transaction",
      "format": "uuid",
      "examples": ["550e8400-e29b-41d4-a716-446655440000"]
    },
    "createdAt": {
      "type": "string",
      "description": "ISO 8601 timestamp when backup was created",
      "format": "date-time",
      "examples": ["2026-01-07T14:32:15Z"]
    },
    "modulePath": {
      "type": "string",
      "description": "Relative path to the module being edited",
      "examples": ["_bmad/bmb", "_bmad/bmm"]
    },
    "backupPath": {
      "type": "string",
      "description": "Relative path to the backup directory",
      "examples": ["_bmad/bmb/.backup/20260107-143215"]
    },
    "files": {
      "type": "array",
      "description": "Array of backed up files with checksums",
      "items": {
        "type": "object",
        "required": [
          "relativePath",
          "originalPath",
          "backupPath",
          "originalChecksum",
          "backupChecksum",
          "checksumVerified",
          "sizeBytes",
          "modifiedAt"
        ],
        "properties": {
          "relativePath": {
            "type": "string",
            "description": "Path relative to module root",
            "examples": ["agents/analyst.md"]
          },
          "originalPath": {
            "type": "string",
            "description": "Full path to original file",
            "examples": ["_bmad/bmb/agents/analyst.md"]
          },
          "backupPath": {
            "type": "string",
            "description": "Full path to backup file",
            "examples": ["_bmad/bmb/.backup/20260107-143215/agents/analyst.md"]
          },
          "originalChecksum": {
            "type": "string",
            "description": "SHA-256 checksum of original file",
            "pattern": "^sha256:[a-f0-9]{64}$",
            "examples": ["sha256:abc123def456..."]
          },
          "backupChecksum": {
            "type": "string",
            "description": "SHA-256 checksum of backup file",
            "pattern": "^sha256:[a-f0-9]{64}$",
            "examples": ["sha256:abc123def456..."]
          },
          "checksumVerified": {
            "type": "boolean",
            "description": "Whether original and backup checksums match",
            "default": false
          },
          "sizeBytes": {
            "type": "integer",
            "description": "File size in bytes",
            "minimum": 0,
            "examples": [2048]
          },
          "modifiedAt": {
            "type": "string",
            "description": "ISO 8601 timestamp of file's last modification",
            "format": "date-time",
            "examples": ["2026-01-05T10:00:00Z"]
          }
        },
        "additionalProperties": false
      }
    },
    "totalFiles": {
      "type": "integer",
      "description": "Total number of files in backup",
      "minimum": 0
    },
    "totalSizeBytes": {
      "type": "integer",
      "description": "Total size of all backed up files in bytes",
      "minimum": 0
    },
    "allVerified": {
      "type": "boolean",
      "description": "Whether all file checksums have been verified",
      "default": false
    },
    "status": {
      "type": "string",
      "description": "Current status of the backup",
      "enum": ["pending", "active", "valid", "restored", "deleted"],
      "default": "pending"
    },
    "metadata": {
      "type": "object",
      "description": "Optional metadata about the edit operation",
      "properties": {
        "user": {
          "type": "string",
          "description": "User who initiated the backup"
        },
        "editType": {
          "type": "string",
          "description": "Type of edit operation",
          "enum": ["modify", "add", "remove"]
        },
        "componentType": {
          "type": "string",
          "description": "Type of component being edited",
          "enum": ["agent", "workflow", "config", "documentation"]
        },
        "componentName": {
          "type": "string",
          "description": "Name of the component being edited"
        }
      },
      "additionalProperties": true
    },
    "restoredAt": {
      "type": "string",
      "description": "ISO 8601 timestamp when backup was restored (if applicable)",
      "format": "date-time"
    },
    "deletedAt": {
      "type": "string",
      "description": "ISO 8601 timestamp when backup was deleted (if applicable)",
      "format": "date-time"
    }
  },
  "additionalProperties": false
}
